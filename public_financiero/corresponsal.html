<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corresponsal | Sistema Financiero</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/corresponsal.css"> 
    <link rel="manifest" href="manifest.json">
    <style>
        /* Estilos inline para los botones de acción (mismos de los otros módulos) */
        .btn-action { border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; margin-left: 5px; transition: transform 0.2s; }
        .btn-edit { background: #ffca28; color: #333; }
        .btn-delete { background: #ef5350; color: white; }
        .btn-action:hover { transform: scale(1.1); }
        .btn-cancel-edit { background: #9e9e9e; color: white; border: none; border-radius: 8px; padding: 0 15px; margin-left: 10px; cursor: pointer; font-size: 1.2rem; }
        .btn-cancel-edit:hover { background: #757575; }
        .text-center { text-align: center; }
        /* Ajuste para que el botón Cancelar quede bien alineado en el botón ancho */
        .btn-container-full { display: flex; align-items: center; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand">
            <div class="logo-circle"><i class="fa-solid fa-shop"></i></div>
            CORRESPONSAL
        </div>
        
        <div class="nav-links">
            <a href="menu.html" class="nav-item">
                <i class="fa-solid fa-table-cells-large"></i> IR AL MENÚ
            </a>
        </div>

        <div class="user-info">
            <span id="userDisplay">Usuario</span>
            <button onclick="logout()" class="btn-logout"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </nav>

    <div class="container-fluid">

        <div class="saldo-hero">
            <div class="saldo-info">
                <span>SALDO CALCULADO</span>
                <h1 id="granSaldo">$ 0.00</h1>
            </div>
            <button class="btn-ajuste" onclick="abrirModalAjuste()">
                <i class="fa-solid fa-sliders"></i> AJUSTAR
            </button>
        </div>
        
        <h3><i class="fa-solid fa-receipt"></i> Ingresar Totales del Cierre (Tirilla)</h3>
        <form id="formCorresponsal">
            <input type="hidden" id="editId">
        
            <div style="text-align: right; margin-bottom: 15px;">
                <button type="button" onclick="sincronizarDatosEnVivo()" style="background:none; border:none; color:#3949ab; cursor:pointer; font-size:0.9rem; font-weight:bold;">
                    <i class="fa-solid fa-sync"></i> Sincronizar con POS
                </button>
                <button type="button" onclick="verCompensacionesHoy()" style="background:none; border:none; color:#c62828; cursor:pointer; font-size:0.9rem; font-weight:bold; margin-right: 15px; border: 1px solid #c62828; padding: 5px 10px; border-radius: 5px;">
                    <i class="fa-solid fa-list-check"></i> Ver Compensaciones
                </button>
            </div>
        
            <div class="form-grid-custom">
                
                <div class="input-group">
                    <label>Fecha</label>
                    <input type="date" id="fecha" required>
                </div>
                <div class="input-group">
                    <label>Hora</label>
                    <input type="time" id="hora" required>
                </div>
                <div class="input-group wide-desc">
                    <label>Descripción / Turno</label>
                    <input type="text" id="descripcion" placeholder="Ej: Cierre Turno Tarde" required autocomplete="off">
                </div>
        
                <div class="divider-label">ENTRADAS (INGRESOS DEL DÍA)</div>
                
                <div class="input-group">
                    <label class="green-text"><i class="fa-solid fa-arrow-down"></i> Depósitos</label>
                    <input type="number" id="deposito" class="live-input live-entry" placeholder="$ 0" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <label class="green-text"><i class="fa-solid fa-file-invoice-dollar"></i> Recaudos</label>
                    <input type="number" id="recaudo" class="live-input live-entry" placeholder="$ 0" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <label class="green-text"><i class="fa-regular fa-credit-card"></i> Pago T. Crédito</label>
                    <input type="number" id="pago_tc" class="live-input live-entry" placeholder="$ 0" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <label class="green-text"><i class="fa-solid fa-hand-holding-dollar"></i> Pago Cartera</label>
                    <input type="number" id="pago_cartera" class="live-input live-entry" placeholder="$ 0" min="0" step="0.01">
                </div>
        
                <div class="divider-label">SALIDAS (EGRESOS DEL DÍA)</div>
        
                <div class="input-group">
                    <label class="red-text"><i class="fa-solid fa-arrow-up"></i> Retiros Cliente</label>
                    <input type="number" id="retiro" class="live-input live-exit" placeholder="$ 0" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <label class="red-text"><i class="fa-solid fa-rotate"></i> Compensaciones</label>
                    <input type="number" id="compensacion" class="live-input live-exit" placeholder="$ 0" min="0" step="0.01">
                </div>
        
                <div class="btn-container-full">
                    <button type="submit" class="btn-save" id="btnSubmit">GUARDAR CIERRE</button>
                    <button type="button" id="btnCancelEdit" class="btn-cancel-edit" style="display: none;" onclick="cancelarEdicion()">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
        </form>

        <div class="card-table">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>FECHA</th>
                            <th>HORA</th>
                            <th>USUARIO</th>
                            <th class="col-entrada">DEPÓSITO</th>
                            <th class="col-entrada">RECAUDO</th>
                            <th class="col-entrada">PAGO TC</th>
                            <th class="col-entrada">CARTERA</th>
                            <th class="col-salida">RETIRO</th>
                            <th class="col-salida">COMPENSACIÓN</th>
                            <th class="col-saldo">NUEVO SALDO</th>
                            <th class="text-center">ACCIONES</th> </tr>
                    </thead>
                    <tbody id="tablaCuerpo">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modalAjuste" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajustar Saldo Corresponsal</h2>
                <button onclick="cerrarModalAjuste()" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Ingresa el saldo real calculado manualmente. Se creará un registro de ajuste.</p>
                <div class="input-group">
                    <label>Nuevo Saldo Real ($)</label>
                    <input type="number" id="nuevoSaldoReal" placeholder="Ej: 5000000" step="0.01">
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="cerrarModalAjuste()" class="btn-cancel">Cancelar</button>
                <button onclick="confirmarAjuste()" class="btn-confirm">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="modalCompensaciones" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 500px; max-width: 90%;">
            <div class="modal-header" style="border-bottom: 2px solid #ffebee;">
                <h2 style="color: #c62828; margin:0;"><i class="fa-solid fa-rotate"></i> Compensaciones de Hoy</h2>
                <button onclick="cerrarModalCompensaciones()" class="close-btn">&times;</button>
            </div>
            
            <div class="modal-body" style="padding-top: 15px;">
                <div style="max-height: 350px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                        <thead style="position: sticky; top: 0; background: white;">
                            <tr style="background: #ffebee; color: #c62828;">
                                <th style="padding: 10px; text-align: left;">Hora</th>
                                <th style="padding: 10px; text-align: left;">Usuario / Detalle</th>
                                <th style="padding: 10px; text-align: right;">Monto</th>
                            </tr>
                        </thead>
                        <tbody id="tablaCompensacionesBody">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div class="modal-footer" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <button onclick="cerrarModalCompensaciones()" class="btn-cancel" style="width: 100%;">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="js/corresponsal.js"></script>
</body>
</html>