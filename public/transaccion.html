<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Transacci√≥n | POS</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/transaccion.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <h3>üöÄ Mi Corresponsal</h3>
        </div>
    
        <div class="user-profile">
            <div class="avatar-circle">U</div>
            <div class="user-info">
                <p>Conectado como:</p>
                <span id="nombreUsuario">Cargando...</span>
            </div>
        </div>
    
        <ul>
            <div class="menu-category">Principal</div>
            
            <li>
                <a href="dashboard.html"> <span class="icon">üìä</span> Resumen
                </a>
            </li>
    
            <div class="menu-category">Operaciones</div>
            
            <li>
                <a href="transaccion.html" class="active">
                    <span class="icon">üí∞</span> Transacciones
                </a>
            </li>
            <li>
                <a href="compensaciones.html">
                    <span class="icon">‚öñÔ∏è</span> Compensar Cupo
                </a>
            </li>
    
            <div class="menu-category">Gesti√≥n</div>
            
            <li>
                <a href="reportes.html">
                    <span class="icon">üìù</span> Historial & Reportes
                </a>
            </li>
            <li>
                <a href="caja.html">
                    <span class="icon">üîê</span> Arqueo de Caja
                </a>
            </li>
            <li>
                <a href="usuarios.html">
                    <span class="icon">üë§</span> Usuarios
                </a>
            </li>
            <li>
                <a href="estadisticas.html">
                    <span class="icon">üìà</span> M√©tricas en Vivo
                </a>
            </li>
        </ul>
    
        <div class="logout-container">
            <a href="#" id="btnLogout" class="danger">
                <span class="icon">üö™</span> Cerrar Sesi√≥n
            </a>
        </div>
    </nav>

    <main class="main-content">
    
        <div class="pos-container transaction-layout">
            
            <section class="panel-izquierdo form-section">
    
                <div class="stats-header" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    
                    <div class="stat-card" style="background:#fff; border-left:4px solid #2ecc71; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="color:#7f8c8d; font-size:0.8rem; font-weight:bold;">EFECTIVO EN CAJA</span>
                            <button onclick="ajustarBase()" class="btn-mini-tool" title="Ajustar">‚öôÔ∏è</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                            <div style="font-size:1.5rem;">üíµ</div>
                            <h3 id="txtBaseActual" style="margin:0; font-size:1.4rem; color:#2c3e50;">$ 0</h3>
                        </div>
                    </div>
                
                    <div class="stat-card" style="background:#fff; border-left:4px solid #3498db; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="color:#7f8c8d; font-size:0.8rem; font-weight:bold;">SALDOS BANCARIOS</span>
                            <button onclick="cargarSaldosBancos()" class="btn-mini-tool" title="Actualizar">üîÑ</button>
                        </div>
                        <div id="listaSaldosBancos" class="bancos-scroll-list" style="margin-top:5px; height:40px; overflow-y:auto; font-size:0.9rem;">
                            <span class="loading-mini">Cargando...</span>
                        </div>
                    </div>
    
                </div>
                
                <div class="form-section-inner" style="margin-bottom:8px;">
                    <label class="label-sub" style="margin-bottom:4px;">1. Seleccione Entidad</label>
                    <div id="gridBancos" class="grid-bancos" style="margin-bottom:0;"></div> 
                    <input type="hidden" id="selectBanco" required>
                </div>
                
                <div class="form-section-inner" style="margin-bottom:10px;">
                    <label class="label-sub" style="margin-bottom:4px;">2. Tipo de Operaci√≥n</label>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 5px;">
                        <button type="button" onclick="abrirModalTipos('RECAUDO')" class="btn-big-trigger btn-ingreso-trigger" style="padding: 12px;">
                            <span class="icon-trigger" style="width:40px; height:40px; font-size:1.5rem;">üì•</span>
                            <div>
                                <span class="title-trigger" style="font-size:1rem;">INGRESO</span>
                                <small class="desc-trigger" style="font-size:0.75rem;">Dep√≥sitos...</small>
                            </div>
                        </button>
                
                        <button type="button" onclick="abrirModalTipos('TESORERIA')" class="btn-big-trigger btn-egreso-trigger" style="padding: 12px;">
                            <span class="icon-trigger" style="width:40px; height:40px; font-size:1.5rem;">üì§</span>
                            <div>
                                <span class="title-trigger" style="font-size:1rem;">SALIDA</span>
                                <small class="desc-trigger" style="font-size:0.75rem;">Retiros...</small>
                            </div>
                        </button>
                    </div>
                
                    <div id="displaySeleccion" class="selection-display" style="display:none; padding: 10px; margin-top: 5px;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span id="iconSeleccion" style="font-size:1.5rem;">‚úÖ</span>
                            <div>
                                <span style="font-size:0.7rem; color:#94a3b8; font-weight:bold;">SELECCIONADO:</span>
                                <h4 id="txtSeleccion" style="margin:0; color:#2c3e50; font-size:1rem;">Ninguna</h4>
                            </div>
                        </div>
                        <button type="button" onclick="limpiarSeleccionTipo()" class="btn-mini-clear" style="font-size:0.75rem; padding: 4px 8px;">Cambiar</button>
                    </div>
                
                    <input type="hidden" id="inputTipoSeleccionado">
                    <input type="hidden" id="inputCategoriaSeleccionada">
                </div>
                
                <form id="formTransaccion" novalidate onsubmit="event.preventDefault()">
                    
                    <div class="highlight-box" style="margin-bottom:10px; padding: 10px;">
                        <label style="color:#7f8c8d; font-size:0.8rem; letter-spacing:1px; margin-bottom:0;">MONTO A PROCESAR</label>
                        <div class="input-wrapper-money">
                            <span class="currency-symbol" style="font-size:1.5rem;">$</span>
                            <input type="text" id="inputMontoVisual" class="input-big-money" placeholder="0" autocomplete="off" style="font-size:1.8rem;">
                            <div class="quick-amounts">
                                <button type="button" onclick="sumarMonto(50000)">+50k</button>
                                <button type="button" onclick="sumarMonto(100000)">+100k</button>
                                <button type="button" onclick="sumarMonto(200000)">+200k</button>
                                <button type="button" onclick="sumarMonto(500000)">+500k</button>
                                <button type="button" onclick="sumarMonto(1000000)">+1m</button>
                                <button type="button" onclick="limpiarMonto()" class="btn-clear-monto">Borrar</button>
                            </div>
                        </div>
                        <input type="hidden" id="inputMonto"> 
                    </div>
                
                    <div class="form-row" style="margin-bottom: 20px;">
                        <div class="col-desc" style="width: 100%;">
                            <div class="input-group-desc">
                                <span class="icon-desc">‚úèÔ∏è</span>
                                <div style="flex:1; min-width: 0;"> 
                                     <label for="inputDesc" style="font-size:0.7rem; color:#64748b; font-weight:800; display:block; margin-bottom:2px; text-transform:uppercase;">
                                        REFERENCIA (OPCIONAL)
                                     </label>
                                     <input type="text" id="inputDesc" class="input-modern" placeholder="Ej: C√©dula, N¬∞ Factura..." autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-container" style="text-align: center;">
                        <button type="button" id="btnAgregar" class="btn-round-action">
                            <span class="btn-icon">‚¨áÔ∏è</span> 
                            <span class="btn-text">AGREGAR</span>
                        </button>
                    </div>
                </form>
        
                <div style="margin-top: 20px; border-top: 1px dashed #e2e8f0; padding-top: 20px;">
                    <button type="button" onclick="abrirModalHistorial()" class="btn-history-trigger">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span style="background:#e0f2fe; color:#0369a1; padding:8px; border-radius:8px;">üìú</span>
                            <div style="text-align:left;">
                                <span style="display:block; font-weight:bold; color:#334155; font-size:0.9rem;">Historial de Hoy</span>
                                <small id="lblResumenHistorial" style="color:#94a3b8; font-size:0.75rem;">0 movimientos</small>
                            </div>
                        </div>
                        <span style="color:#cbd5e1;">‚ûî</span>
                    </button>
                </div>
    
            </section>
        
            <section class="panel-derecho cart-section" style="
                background-color: #f1f4f8; 
                padding: 25px; 
                border-radius: 20px; 
                border: 1px solid #dce4ec; 
                display: flex; 
                flex-direction: column; 
                min-height: 500px;
                position: sticky; top: 20px;">
                
                <div class="cart-header" style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px dashed #cbd5e0; padding-bottom:15px; margin-bottom:15px;">
                    <div>
                        <h3 style="margin:0; color:#2c3e50;">üõí Cliente Actual</h3>
                        <small style="color:#7f8c8d;">Operaciones en cola</small>
                    </div>
                    <button id="btnLimpiarLista" style="background:none; border:none; color:#e74c3c; cursor:pointer; font-weight:bold; font-size:0.9rem;">
                        üóëÔ∏è Borrar Todo
                    </button>
                </div>
    
                <div class="cart-items-container" style="flex:1; overflow-y:auto; margin-bottom:20px;">
                    <div id="listaOperaciones" class="items-list">
                        <div class="empty-state" style="text-align:center; color:#95a5a6; margin-top:60px;">
                            <span class="icon" style="font-size:3rem; display:block; opacity:0.5;">üõí</span>
                            <p>El carrito est√° vac√≠o</p>
                            <small>Usa el panel izquierdo para agregar</small>
                        </div>
                    </div>
                </div>
    
                <div class="cart-footer" style="border-top:2px dashed #cbd5e0; padding-top:20px;">
                    <div class="row-total" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <span style="font-size:1.1rem; color:#7f8c8d;">Total a Cobrar:</span>
                        <strong id="lblTotalCliente" style="font-size:1.8rem; color:#2c3e50;">$ 0</strong>
                    </div>
                    
                    <button id="btnFinalizar" class="btn-process" disabled style="
                        width: 100%;
                        padding: 18px;
                        background: linear-gradient(135deg, #27ae60, #2ecc71);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        font-size: 1.1rem;
                        font-weight: bold;
                        cursor: pointer;
                        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
                        text-transform: uppercase;">
                        ‚úÖ COBRAR / FINALIZAR
                    </button>
                    <button id="btnAbrirCajon" style="
                        width: auto;                  /* Ya no ocupa todo el ancho */
                        margin: 20px auto 0 auto;     /* 20px de separaci√≥n arriba, centrado horizontalmente */
                        padding: 8px 15px;            /* M√°s delgado y corto */
                        background-color: transparent;/* Fondo transparente para que no compita */
                        color: #7f8c8d;               /* Color gris discreto */
                        border: 1px dashed #bdc3c7;   /* Borde punteado suave */
                        border-radius: 6px;
                        font-size: 0.85rem;           /* Letra m√°s peque√±a */
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 5px;
                        transition: all 0.2s;
                    " onmouseover="this.style.borderColor='#7f8c8d'; this.style.color='#2c3e50'" 
                    onmouseout="this.style.borderColor='#bdc3c7'; this.style.color='#7f8c8d'">
                        üîë <span style="font-weight: normal;">Caj√≥n Admin</span>
                    </button>
                </div>
    
            </section>
        </div>
    
    </main>

    <div id="modalCobro" class="modal-overlay" style="display:none;">
        <div class="modal-glass">
            <div class="modal-header">
                <h2>üí∞ Finalizar Transacci√≥n</h2>
                <button id="btnCancelarModal" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="info-block">
                    <span>Total a Pagar</span>
                    <div id="modalTotal" class="big-number text-dark">$ 0</div>
                </div>
    
                <div class="payment-block">
                    <label>¬øCon cu√°nto paga el cliente?</label>
                    <input type="text" id="inputPagaCon" class="input-payment" placeholder="$ 0" autocomplete="off">
                    <input type="hidden" id="inputPagaConHidden">
                </div>
    
                <div class="info-block result-block">
                    <span>Devuelta / Cambio</span>
                    <div id="modalDevuelta" class="big-number text-success">$ 0</div>
                </div>
            </div>
    
            <div class="modal-actions">
                <button id="btnConfirmarTodo" class="btn-confirm-all">
                    ‚úÖ CONFIRMAR Y GUARDAR
                </button>
            </div>
        </div>
    </div>

    <div id="modalTipos" class="modal-overlay" style="display:none; z-index: 3000;">
        <div class="modal-glass modal-wide">
            <div class="modal-header">
                <h2 id="tituloModalTipos">Seleccione una opci√≥n</h2>
                <button onclick="cerrarModalTipos()" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div id="gridOpcionesTipos" class="grid-tipos-modal"></div>
            </div>
        </div>
    </div>

    <div id="modalHistorial" class="modal-overlay" style="display:none; z-index: 3100;">
        <div class="modal-glass modal-wide" style="max-width: 700px;">
            <div class="modal-header" style="border-bottom: 1px solid #f1f5f9; padding-bottom:15px;">
                <div>
                    <h2 style="margin:0; color:#1e293b; font-size:1.3rem;">üìú Movimientos del D√≠a</h2>
                    <small style="color:#64748b;">Solo se muestran transacciones de tu sesi√≥n actual</small>
                </div>
                <button onclick="cerrarModalHistorial()" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body" style="padding: 0;">
    
                <div class="filter-container" style="padding: 15px 20px; background: #fff; border-bottom: 1px solid #f1f5f9; display: flex; gap: 10px; flex-wrap: wrap;">
                    <div class="input-icon-wrapper" style="flex: 2;">
                        <span class="icon-input">üîç</span>
                        <input type="text" id="filtroTipo" class="input-filter-pro" placeholder="Buscar por Tipo o Descripci√≥n..." onkeyup="filtrarHistorial()">
                    </div>
                    
                    <div class="input-icon-wrapper" style="flex: 1;">
                        <span class="icon-input">üí≤</span>
                        <input type="number" id="filtroMonto" class="input-filter-pro" placeholder="Monto" onkeyup="filtrarHistorial()">
                    </div>
            
                    <div class="input-icon-wrapper" style="flex: 1;">
                        <span class="icon-input">‚è∞</span>
                        <input type="text" id="filtroHora" class="input-filter-pro" placeholder="Hora (ej: 14:30)" onkeyup="filtrarHistorial()">
                    </div>
                </div>
            
                <div class="history-table-header">
                    <span>Hora</span>
                    <span>Banco / Detalle</span>
                    <span style="text-align:right;">Monto</span>
                    <span style="text-align:center;">Acci√≥n</span>
                </div>
    
                <div id="listaMovimientosModal" class="history-list-container">
                    <div class="empty-state-modal">Cargando...</div>
                </div>
            </div>
            
            <div class="modal-footer" style="padding:15px; background:#f8fafc; border-top:1px solid #e2e8f0; text-align:right; border-radius: 0 0 20px 20px;">
                <button onclick="cerrarModalHistorial()" class="btn-cancel" style="padding:10px 20px; font-size:0.9rem;">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="modalAuth" class="modal-overlay" style="display:none; align-items:center; justify-content:center; z-index: 2000;">
        <div class="modal-glass" style="max-width:350px; padding:25px; text-align:center;">
            <h3 style="margin-top:0; color:#2c3e50;">üîí Autorizaci√≥n Requerida</h3>
            <p style="color:#7f8c8d; font-size:0.9rem;">Un administrador debe ingresar su contrase√±a para continuar.</p>
            
            <input type="password" id="inputAdminPass" class="input-std" 
                style="width:90%; padding:12px; border-radius:8px; border:2px solid #bdc3c7; font-size:1.1rem; text-align:center;" 
                placeholder="Contrase√±a Admin">
                
            <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
                <button id="btnCancelAuth" style="background:#95a5a6; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">Cancelar</button>
                <button id="btnConfirmAuth" style="background:#2c3e50; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold;">Verificar</button>
            </div>
        </div>
    </div>

    <script src="js/transaccion.js"></script>
</body>
</html>