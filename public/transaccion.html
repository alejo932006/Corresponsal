<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Transacci√≥n | POS</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/transaccion.css">
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <h3>üöÄ Mi Corresponsal</h3>
        </div>
    
        <div class="user-profile">
            <div class="avatar-circle">U</div>
            <div class="user-info">
                <p>Conectado como:</p>
                <span id="nombreUsuario">Cargando...</span>
            </div>
        </div>
    
        <ul>
            <div class="menu-category">Principal</div>
            
            <li>
                <a href="dashboard.html"> <span class="icon">üìä</span> Resumen
                </a>
            </li>
    
            <div class="menu-category">Operaciones</div>
            
            <li>
                <a href="transaccion.html" class="active">
                    <span class="icon">üí∞</span> Transacciones
                </a>
            </li>
            <li>
                <a href="compensaciones.html">
                    <span class="icon">‚öñÔ∏è</span> Compensar Cupo
                </a>
            </li>
    
            <div class="menu-category">Gesti√≥n</div>
            
            <li>
                <a href="reportes.html">
                    <span class="icon">üìù</span> Historial & Reportes
                </a>
            </li>
            <li>
                <a href="caja.html">
                    <span class="icon">üîê</span> Arqueo de Caja
                </a>
            </li>
            <li>
                <a href="usuarios.html">
                    <span class="icon">üë§</span> Usuarios
                </a>
            </li>
            <li>
                <a href="estadisticas.html">
                    <span class="icon">üìà</span> M√©tricas en Vivo
                </a>
            </li>
        </ul>
    
        <div class="logout-container">
            <a href="#" id="btnLogout" class="danger">
                <span class="icon">üö™</span> Cerrar Sesi√≥n
            </a>
        </div>
    </nav>

    <main class="main-content">
    
        <div class="pos-container transaction-layout">
            
            <section class="panel-izquierdo form-section">
    
                <div class="stats-header" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    
                    <div class="stat-card" style="background:#fff; border-left:4px solid #2ecc71; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="color:#7f8c8d; font-size:0.8rem; font-weight:bold;">EFECTIVO EN CAJA</span>
                            <button onclick="ajustarBase()" class="btn-mini-tool" title="Ajustar">‚öôÔ∏è</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                            <div style="font-size:1.5rem;">üíµ</div>
                            <h3 id="txtBaseActual" style="margin:0; font-size:1.4rem; color:#2c3e50;">$ 0</h3>
                        </div>
                    </div>
                
                    <div class="stat-card" style="background:#fff; border-left:4px solid #3498db; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="color:#7f8c8d; font-size:0.8rem; font-weight:bold;">SALDOS BANCARIOS</span>
                            <button onclick="cargarSaldosBancos()" class="btn-mini-tool" title="Actualizar">üîÑ</button>
                        </div>
                        <div id="listaSaldosBancos" class="bancos-scroll-list" style="margin-top:5px; height:40px; overflow-y:auto; font-size:0.9rem;">
                            <span class="loading-mini">Cargando...</span>
                        </div>
                    </div>
    
                </div>
                
                <div class="card-glass" style="box-shadow: none; padding: 0;">
                    <header class="card-header" style="margin-bottom: 20px;">
                        <div class="toggle-tipo" style="display:flex; gap:10px; width:100%;">
                            <label class="switch-label" style="flex:1;">
                                <input type="radio" name="categoria" value="RECAUDO" checked>
                                <span class="btn-switch btn-ingreso" style="display:block; text-align:center; padding:12px; border-radius:8px; border:2px solid #e2e8f0; cursor:pointer; font-weight:bold;">
                                    üì• INGRESO (Recaudo)
                                </span>
                            </label>
                            <label class="switch-label" style="flex:1;">
                                <input type="radio" name="categoria" value="TESORERIA">
                                <span class="btn-switch btn-egreso" style="display:block; text-align:center; padding:12px; border-radius:8px; border:2px solid #e2e8f0; cursor:pointer; font-weight:bold;">
                                    üì§ SALIDA (Retiro)
                                </span>
                            </label>
                        </div>
                    </header>
        
                    <form id="formTransaccion" novalidate onsubmit="event.preventDefault()">
                        
                        <div class="form-section-inner" style="margin-bottom:20px;">
                            <label class="label-sub" style="font-weight:bold; color:#2c3e50; display:block; margin-bottom:10px;">Seleccione Entidad</label>
                            <div id="gridBancos" class="grid-bancos" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap:10px;">
                                </div>
                            <input type="hidden" id="selectBanco" required>
                        </div>
        
                        <div id="groupTipo" class="animate-slide-down" style="display:none; margin-bottom:20px;">
                            <label class="label-sub" style="font-weight:bold;">Tipo de Transacci√≥n</label>
                            <select id="selectTipo" class="input-std full-width" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;"></select>
                        </div>
        
                        <div class="highlight-box" style="background:#f8f9fa; padding:20px; border-radius:12px; text-align:center; margin-bottom:20px; border:1px solid #e9ecef;">
                            <label style="color:#7f8c8d; font-size:0.9rem; letter-spacing:1px;">MONTO A PROCESAR</label>
                            <div class="input-wrapper-money" style="position:relative; max-width:250px; margin:0 auto;">
                                <span style="position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:1.5rem; color:#2c3e50;">$</span>
                                <input type="text" id="inputMontoVisual" class="input-big-money" placeholder="0" autocomplete="off" 
                                    style="width:100%; font-size:2rem; font-weight:bold; border:none; background:transparent; text-align:center; color:#2c3e50; outline:none;">
                            </div>
                            <input type="hidden" id="inputMonto"> 
                        </div>
        
                        <div class="form-row" style="display:flex; gap:40px;">
                            <div class="col-desc" style="flex:1;">
                                <input type="text" id="inputDesc" class="input-std" placeholder="Referencia / Descripci√≥n (Opcional)"
                                    style="width:100%; padding:15px; border-radius:8px; border:2px solid #e2e8f0;">
                            </div>
                            <div class="col-btn">
                                <button type="button" id="btnAgregar" class="btn-action-add" 
                                    style="background:#2c3e50; color:white; border:none; padding:15px 25px; border-radius:8px; font-weight:bold; cursor:pointer; height:100%;">
                                    ‚¨áÔ∏è AGREGAR
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
        
                <div class="recent-history" style="margin-top:30px; border-top:1px dashed #ccc; padding-top:20px;">
                    <header class="card-header-small" style="display:flex; justify-content:space-between; margin-bottom:15px;">
                        <h4 style="margin:0; color:#7f8c8d;">üìí Historial Reciente</h4>
                        <span id="contadorMovimientos" style="background:#eee; padding:2px 8px; border-radius:10px; font-size:0.8rem;">0</span>
                    </header>
                    <div id="listaMovimientos" class="mini-feed">
                        <div class="empty-feed" style="color:#aaa; font-style:italic;">Cargando historial...</div>
                    </div>
                </div>
    
            </section>
        
            <section class="panel-derecho cart-section" style="
                background-color: #f1f4f8; 
                padding: 25px; 
                border-radius: 20px; 
                border: 1px solid #dce4ec; 
                display: flex; 
                flex-direction: column; 
                min-height: 500px;
                position: sticky; top: 20px;">
                
                <div class="cart-header" style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px dashed #cbd5e0; padding-bottom:15px; margin-bottom:15px;">
                    <div>
                        <h3 style="margin:0; color:#2c3e50;">üõí Cliente Actual</h3>
                        <small style="color:#7f8c8d;">Operaciones en cola</small>
                    </div>
                    <button id="btnLimpiarLista" style="background:none; border:none; color:#e74c3c; cursor:pointer; font-weight:bold; font-size:0.9rem;">
                        üóëÔ∏è Borrar Todo
                    </button>
                </div>
    
                <div class="cart-items-container" style="flex:1; overflow-y:auto; margin-bottom:20px;">
                    <div id="listaOperaciones" class="items-list">
                        <div class="empty-state" style="text-align:center; color:#95a5a6; margin-top:60px;">
                            <span class="icon" style="font-size:3rem; display:block; opacity:0.5;">üõí</span>
                            <p>El carrito est√° vac√≠o</p>
                            <small>Usa el panel izquierdo para agregar</small>
                        </div>
                    </div>
                </div>
    
                <div class="cart-footer" style="border-top:2px dashed #cbd5e0; padding-top:20px;">
                    <div class="row-total" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <span style="font-size:1.1rem; color:#7f8c8d;">Total a Cobrar:</span>
                        <strong id="lblTotalCliente" style="font-size:1.8rem; color:#2c3e50;">$ 0</strong>
                    </div>
                    
                    <button id="btnFinalizar" class="btn-process" disabled style="
                        width: 100%;
                        padding: 18px;
                        background: linear-gradient(135deg, #27ae60, #2ecc71);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        font-size: 1.1rem;
                        font-weight: bold;
                        cursor: pointer;
                        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
                        text-transform: uppercase;">
                        ‚úÖ COBRAR / FINALIZAR
                    </button>
                </div>
    
            </section>
        </div>
    
    </main>

    <div id="modalCobro" class="modal-overlay" style="display:none;">
        <div class="modal-glass">
            <div class="modal-header">
                <h2>üí∞ Finalizar Transacci√≥n</h2>
                <button id="btnCancelarModal" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="info-block">
                    <span>Total a Pagar</span>
                    <div id="modalTotal" class="big-number text-dark">$ 0</div>
                </div>
    
                <div class="payment-block">
                    <label>¬øCon cu√°nto paga el cliente?</label>
                    <input type="text" id="inputPagaCon" class="input-payment" placeholder="$ 0" autocomplete="off">
                    <input type="hidden" id="inputPagaConHidden">
                </div>
    
                <div class="info-block result-block">
                    <span>Devuelta / Cambio</span>
                    <div id="modalDevuelta" class="big-number text-success">$ 0</div>
                </div>
            </div>
    
            <div class="modal-actions">
                <button id="btnConfirmarTodo" class="btn-confirm-all">
                    ‚úÖ CONFIRMAR Y GUARDAR
                </button>
            </div>
        </div>
    </div>

    <script src="js/transaccion.js"></script>
</body>
</html>